## âœ… 1. å®‰è£…å¿…è¦ä¾èµ–

```bash
npm install reflect-metadata
```

------

## âœ… 2. TypeScript é…ç½®ï¼ˆtsconfig.jsonï¼‰

ä½ å¿…é¡»å¯ç”¨ä¸¤ä¸ªç¼–è¯‘å™¨é€‰é¡¹ï¼š

```json
{
  "compilerOptions": {
    "target": "ES6", // å¿…é¡»è‡³å°‘ä¸º ES6ï¼ˆå› ä¸ºéœ€è¦ classã€Reflect APIï¼‰
    "experimentalDecorators": true, // å¯ç”¨è£…é¥°å™¨
    "emitDecoratorMetadata": true,  // å¯ç”¨è£…é¥°å™¨çš„ç±»å‹å…ƒæ•°æ®ï¼ˆä¼šç”Ÿæˆ design:type ç­‰ï¼‰
    "module": "ESNext", // æˆ– "ES6" / "ES2020"ï¼Œç”¨äºæ”¯æŒæ¨¡å—åŒ–
    "moduleResolution": "node",
    "strict": true
  }
}
```

> âš ï¸ **é‡ç‚¹**ï¼š
>
> - `emitDecoratorMetadata: true` æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ä¸ä¼šç”Ÿæˆ `design:type` ç­‰å…ƒæ•°æ®ï¼›
> - `experimentalDecorators: true` æ˜¯å¼€å¯è£…é¥°å™¨æ”¯æŒçš„æ ¸å¿ƒï¼›
> - `target` ä¸ä½äº `ES6`ï¼Œå¦åˆ™æµè§ˆå™¨å’Œ TypeScript éƒ½æ— æ³•è¿è¡Œ Reflect APIã€‚

------

## âœ… 3. åœ¨å…¥å£æ–‡ä»¶å¼•å…¥ reflect-metadata

åœ¨ä½ é¡¹ç›®çš„ä¸»å…¥å£ï¼ˆå¦‚ `main.ts`, `index.ts`ï¼‰ä¸­**æœ€é¡¶å±‚**æ·»åŠ ï¼š

```javascript
import 'reflect-metadata';
```

> å¿…é¡»åœ¨ä½¿ç”¨è£…é¥°å™¨å‰åŠ è½½ï¼Œå¦åˆ™ Reflect ä¸ä¼šæ”¶é›† metadata ä¿¡æ¯ã€‚

------

## âœ… 4. æµè§ˆå™¨ polyfillï¼ˆå…¼å®¹ Reflect APIï¼‰

- **`reflect-metadata` æœ¬èº«å°±å®ç°äº† Reflect.metadata ç›¸å…³åŠŸèƒ½**ï¼›
- ä¸éœ€è¦é¢å¤– polyfill `Reflect`ï¼Œé™¤éä½ ä½¿ç”¨äº† IEï¼ˆä½ç‰ˆæœ¬æµè§ˆå™¨ï¼‰ï¼›
- æ‰€ä»¥åªéœ€å¼•å…¥ `reflect-metadata` å³å¯ã€‚

------

## âœ… 5. æ„å»ºå·¥å…·æ³¨æ„äº‹é¡¹ï¼ˆVite/Webpackï¼‰

### ğŸ‘‰ Vite é¡¹ç›®ï¼ˆé»˜è®¤æ”¯æŒ ESMï¼‰

åœ¨å…¥å£æ·»åŠ ï¼š

```javascript
import 'reflect-metadata';
```

ç¡®ä¿ `vite.config.ts` æ”¯æŒ ESM è¾“å‡ºå³å¯ï¼Œæ— éœ€ç‰¹æ®Šé…ç½®ã€‚

### ğŸ‘‰ Webpack é¡¹ç›®

ç¡®ä¿å…¥å£æ–‡ä»¶ï¼ˆå¦‚ `main.ts`ï¼‰é¡¶éƒ¨å¼•å…¥ï¼š

```javascript
import 'reflect-metadata';
```

å¦‚æœç”¨ Babel ç¼–è¯‘ TypeScriptï¼Œè¯·å¯ç”¨ï¼š

- `@babel/plugin-proposal-decorators`ï¼ˆlegacy æ¨¡å¼ï¼‰
- `@babel/plugin-proposal-class-properties`
- `@babel/plugin-transform-typescript`ï¼ˆå¹¶å¼€å¯ `emitDecoratorMetadata`ï¼‰

å»ºè®®ç›´æ¥ä½¿ç”¨ TypeScript ç¼–è¯‘ï¼ˆ`ts-loader` æˆ– `esbuild-loader`ï¼‰æ¥ç®€åŒ–ã€‚

------

## âœ… 6. å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜                                    | åŸå›                                                        |
| --------------------------------------- | ---------------------------------------------------------- |
| `Reflect.getMetadata is not a function` | æ²¡æœ‰å¼•å…¥ `reflect-metadata`ï¼Œæˆ–å¼•å…¥é¡ºåºé”™è¯¯                |
| `design:type` ä¸º `undefined`            | `emitDecoratorMetadata: true` æ²¡å¼€ï¼Œæˆ–è€…æ²¡æœ‰åŠ è£…é¥°å™¨       |
| è£…é¥°å™¨æ²¡ç”Ÿæ•ˆ                            | `experimentalDecorators: true` æ²¡å¼€å¯                      |
| æµè§ˆå™¨æŠ¥ `Reflect is not defined`       | æå°‘è§ï¼Œé™¤éä½ é¡¹ç›®æ²¡æœ‰ä»»ä½• polyfill ä¸”è¿è¡Œåœ¨æ—§ç‰ˆæµè§ˆå™¨ä¸Š   |
| æ‰“åŒ…åä¸¢å¤±å…ƒæ•°æ®                        | å¯èƒ½ Tree-shaking å‰”é™¤äº† reflect-metadataï¼Œå»ºè®®æ˜¾å¼ import |

------

## âœ… æ€»ç»“

| é¡¹ç›®                    | æ˜¯å¦å¿…é¡» | è¯´æ˜                                               |
| ----------------------- | -------- | -------------------------------------------------- |
| `reflect-metadata` å®‰è£… | âœ…        | æä¾› Reflect çš„ metadata æ”¯æŒ                      |
| tsconfig é…ç½®           | âœ…        | `experimentalDecorators` + `emitDecoratorMetadata` |
| å…¥å£æ–‡ä»¶å¼•å…¥            | âœ…        | `import 'reflect-metadata'` è¦æœ€é¡¶éƒ¨               |
| æµè§ˆå™¨æ”¯æŒ              | âœ…        | ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒï¼Œæ— éœ€é¢å¤– polyfill                |