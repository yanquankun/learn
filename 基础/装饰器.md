# ğŸ§© JavaScript è£…é¥°å™¨è¯¦è§£ï¼ˆå«å‚æ•°è¯´æ˜ + åº”ç”¨ä»·å€¼ï¼‰

------

## 1ï¸âƒ£ ç±»è£…é¥°å™¨ï¼ˆClass Decoratorï¼‰

### âœ… èƒ½åšä»€ä¹ˆï¼Ÿ

- æ‹“å±•ç±»åŠŸèƒ½ï¼ˆå¦‚æ·»åŠ é™æ€å±æ€§ã€æ–¹æ³•ï¼‰
- æ›¿æ¢åŸç±»ï¼ˆç»§æ‰¿ã€æ”¹å†™åŸé€»è¾‘ï¼‰
- è‡ªåŠ¨æ³¨å†Œç±»åˆ°æŸä¸ªæ¡†æ¶ä¸Šä¸‹æ–‡

### ğŸ§ª åº”ç”¨åœºæ™¯ï¼š

- æ—¥å¿—è®°å½•ç±»åŠ è½½ï¼ˆå¦‚åœ¨ NestJS ä¸­æ³¨å…¥æ¨¡å—ï¼‰
- è‡ªåŠ¨ä¾èµ–æ³¨å…¥ï¼ˆå¦‚ IoC å®¹å™¨ç»‘å®šï¼‰
- ä¸ºç±»æ‰“æ ‡è®°åšåˆ†ç±»æˆ–å…ƒä¿¡æ¯å¤„ç†

```javascript
/**
 * @param {Function} constructor - è¢«è£…é¥°çš„ç±»çš„æ„é€ å‡½æ•°
 */
function Logger(constructor: Function) {
  console.log(`åˆ›å»ºç±»: ${constructor.name}`);
}

@Logger
class Person {
  constructor() {
    console.log('Person å®ä¾‹å·²åˆ›å»º');
  }
}

// è¾“å‡ºï¼š
// åˆ›å»ºç±»: Person
// Person å®ä¾‹å·²åˆ›å»º
```

------

## 2ï¸âƒ£ å±æ€§è£…é¥°å™¨ï¼ˆProperty Decoratorï¼‰

### âœ… èƒ½åšä»€ä¹ˆï¼Ÿ

- ä¿®æ”¹å±æ€§çš„è¯»å†™æƒé™
- æ·»åŠ å…ƒæ•°æ®ï¼ˆé…åˆåå°„æœºåˆ¶å®ç°è¡¨å•è‡ªåŠ¨åŒ–ï¼‰
- å®ç°å“åº”å¼ç³»ç»Ÿã€çŠ¶æ€ç›‘å¬ç­‰

### ğŸ§ª åº”ç”¨åœºæ™¯ï¼š

- å®ç°å±æ€§åªè¯» / ç¦æ­¢ä¿®æ”¹
- æ•°æ®æ¨¡å‹ä¸è¡¨å•å­—æ®µè‡ªåŠ¨ç»‘å®šï¼ˆå¦‚ Angular/Nestï¼‰
- å®ç°å“åº”å¼æ•°æ®ç³»ç»Ÿï¼ˆå¦‚ MobXï¼‰

```javascript
/**
 * @param {Object} target - åŸå‹å¯¹è±¡
 * @param {string} propertyKey - å±æ€§å
 */
function Readonly(target: any, propertyKey: string) {
  Object.defineProperty(target, propertyKey, {
    writable: false,
    configurable: false,
  });
}

class User {
  @Readonly
  name = 'å¼ ä¸‰';
}

const user = new User();
user.name = 'æå››'; // âŒ é™é»˜å¤±è´¥
console.log(user.name); // å¼ ä¸‰
```

------

## 3ï¸âƒ£ æ–¹æ³•è£…é¥°å™¨ï¼ˆMethod Decoratorï¼‰

### âœ… èƒ½åšä»€ä¹ˆï¼Ÿ

- åŒ…è£…æ–¹æ³•é€»è¾‘ï¼ˆåˆ‡é¢ç¼–ç¨‹ï¼‰
- æ·»åŠ æ—¥å¿—ã€æƒé™æ§åˆ¶ã€èŠ‚æµé˜²æŠ–ç­‰
- å®ç°ç¼“å­˜ã€é”™è¯¯å¤„ç†å°è£…

### ğŸ§ª åº”ç”¨åœºæ™¯ï¼š

- æ‰€æœ‰é€šç”¨æ“ä½œå¢å¼ºï¼Œå¦‚ï¼š**æ—¥å¿—è®°å½•ã€ç¼“å­˜ã€æ€§èƒ½ç›‘æ§**
- å®‰å…¨æ§åˆ¶ï¼ˆä¾‹å¦‚ @AdminOnlyï¼‰
- è‡ªåŠ¨é‡è¯•ã€å¹‚ç­‰é€»è¾‘å°è£…

```javascript
/**
 * @param {Object} target - åŸå‹å¯¹è±¡
 * @param {string} propertyKey - æ–¹æ³•å
 * @param {PropertyDescriptor} descriptor - æ–¹æ³•æè¿°ç¬¦
 */
function Log(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  descriptor.value = function (...args: any[]) {
    console.log(`è°ƒç”¨æ–¹æ³• ${propertyKey}ï¼Œå‚æ•°:`, args);
    return originalMethod.apply(this, args);
  };
}

class Calculator {
  @Log
  add(a: number, b: number) {
    return a + b;
  }
}

const calc = new Calculator();
console.log(calc.add(2, 3));
// è¾“å‡ºï¼šè°ƒç”¨æ–¹æ³• addï¼Œå‚æ•°: [2, 3]
// 5
```

------

## 4ï¸âƒ£ å­˜å–å™¨è£…é¥°å™¨ï¼ˆGetter/Setter Decoratorï¼‰

### âœ… èƒ½åšä»€ä¹ˆï¼Ÿ

- æ§åˆ¶è®¿é—®å™¨è¡Œä¸ºï¼ˆæ—¥å¿—ã€æƒé™æ ¡éªŒï¼‰
- å»¶è¿ŸåŠ è½½ï¼ˆLazyLoadï¼‰
- å“åº”å¼è¿½è¸ª getter çš„ä¾èµ–

### ğŸ§ª åº”ç”¨åœºæ™¯ï¼š

- æ—¥å¿—è¿½è¸ªè¯»å–å­—æ®µ
- ç§æœ‰æ•°æ®è®¿é—®æˆæƒ
- MobX / Vue è¿™ç±»å“åº”å¼åº“æ ¸å¿ƒä¾èµ– getter

```javascript
/**
 * @param {Object} target - åŸå‹å¯¹è±¡
 * @param {string} propertyKey - å±æ€§å
 * @param {PropertyDescriptor} descriptor - æè¿°ç¬¦
 */
function AccessLog(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalGetter = descriptor.get;
  descriptor.get = function () {
    console.log(`è®¿é—®å±æ€§: ${propertyKey}`);
    return originalGetter?.call(this);
  };
}

class PersonInfo {
  private _name = 'å°çº¢';

  @AccessLog
  get name() {
    return this._name;
  }
}

const p = new PersonInfo();
console.log(p.name);
// è¾“å‡ºï¼šè®¿é—®å±æ€§: name
// å°çº¢
```

------

## 5ï¸âƒ£ å‚æ•°è£…é¥°å™¨ï¼ˆParameter Decoratorï¼‰

### âœ… èƒ½åšä»€ä¹ˆï¼Ÿ

- è·å–å‚æ•°ä½ç½®åŠå…ƒä¿¡æ¯
- è‡ªåŠ¨ä¾èµ–æ³¨å…¥ï¼ˆå¦‚ NestJS å‚æ•°è§£æï¼‰
- æ ¡éªŒè¾“å…¥å‚æ•°åˆæ³•æ€§ï¼ˆç»“åˆåå°„ï¼‰

### ğŸ§ª åº”ç”¨åœºæ™¯ï¼š

- å‚æ•°æ ¡éªŒä¸è£…é¥°ï¼ˆå¦‚ @Bodyã€@Queryï¼‰
- æ³¨å…¥å…ƒæ•°æ®ç”¨äºè‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ CLIã€Formï¼‰
- æƒé™æ§åˆ¶ï¼ˆå¦‚æŒ‡å®šæŸå‚æ•°å¿…é¡»ä¸ºç®¡ç†å‘˜ IDï¼‰

```javascript
/**
 * @param {Object} target - åŸå‹å¯¹è±¡
 * @param {string} methodName - æ–¹æ³•å
 * @param {number} parameterIndex - å‚æ•°ç´¢å¼•
 */
function LogParam(target: any, methodName: string, parameterIndex: number) {
  console.log(`å‚æ•°è£…é¥°å™¨ï¼šæ–¹æ³• "${methodName}" çš„ç¬¬ ${parameterIndex + 1} ä¸ªå‚æ•°`);
}

class Service {
  greet(@LogParam name: string) {
    console.log(`Hello, ${name}`);
  }
}

const s = new Service();
s.greet('å¼ ä¸‰');
// è¾“å‡ºï¼š
// å‚æ•°è£…é¥°å™¨ï¼šæ–¹æ³• "greet" çš„ç¬¬ 1 ä¸ªå‚æ•°
// Hello, å¼ ä¸‰
```

------

# ğŸ“¦ åº”ç”¨åœºæ™¯æ±‡æ€»ï¼ˆä¸‰ä¸ªå®Œæ•´æ¡ˆä¾‹ï¼‰

------

### âœ… å‚æ•°æ ¡éªŒï¼ˆé˜²æ­¢éæ³•æ•°æ®æäº¤ï¼‰

```javascript
function NotEmpty(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const original = descriptor.value;
  descriptor.value = function (...args: any[]) {
    if (args.some(arg => arg == null || arg === '')) {
      throw new Error(`[${propertyKey}] å‚æ•°ä¸èƒ½ä¸ºç©º`);
    }
    return original.apply(this, args);
  };
}

class FormService {
  @NotEmpty
  save(data: string) {
    console.log('ä¿å­˜æ•°æ®ï¼š', data);
  }
}

const form = new FormService();
form.save('hello'); // ä¿å­˜æ•°æ®ï¼šhello
// form.save('');    // âŒ æŠ›é”™ï¼š[save] å‚æ•°ä¸èƒ½ä¸ºç©º
```

------

### âœ… ç¼“å­˜å‡½æ•°ç»“æœï¼ˆå¦‚é€’å½’ä¼˜åŒ–ï¼‰

```javascript
function CacheResult(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const cache = new Map<string, any>();
  const original = descriptor.value;
  descriptor.value = function (...args: any[]) {
    const key = JSON.stringify(args);
    if (cache.has(key)) {
      console.log('è¯»å–ç¼“å­˜:', key);
      return cache.get(key);
    }
    const result = original.apply(this, args);
    cache.set(key, result);
    return result;
  };
}

class FibService {
  @CacheResult
  fib(n: number): number {
    if (n <= 1) return n;
    return this.fib(n - 1) + this.fib(n - 2);
  }
}

const fs = new FibService();
console.log(fs.fib(5)); // æ­£å¸¸è®¡ç®—
console.log(fs.fib(5)); // ä»ç¼“å­˜è·å–
// è¾“å‡ºï¼š
// è¯»å–ç¼“å­˜: [5]
// 5
```

------

### âœ… AOP å¢å¼ºæ—¥å¿—é€»è¾‘ï¼ˆå‰ç½®å¢å¼ºï¼‰

```javascript
function BeforeLog(message: string) {
  return function (target: any, key: string, descriptor: PropertyDescriptor) {
    const original = descriptor.value;
    descriptor.value = function (...args: any[]) {
      console.log(`[AOP] ${message}`);
      return original.apply(this, args);
    };
  };
}

class LoginService {
  @BeforeLog('æ ¡éªŒç”¨æˆ·èº«ä»½')
  login(user: string) {
    console.log(`${user} ç™»å½•ç³»ç»Ÿ`);
  }
}

const service = new LoginService();
service.login('admin');
// è¾“å‡ºï¼š
// [AOP] æ ¡éªŒç”¨æˆ·èº«ä»½
// admin ç™»å½•ç³»ç»Ÿ
```